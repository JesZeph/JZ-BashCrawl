#!/bin/bash
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#

roll() {
    echo "Enter a number."
    read NUM
    ALPHA=$RANDOM
    OMEGA=$RANDOM
    A=`echo $ALPHA | cut -b 1-2`
    O=`echo $OMEGA | cut -b 1-2`
    let "NUM=$ALPHA % $OMEGA"
    MONSTER=$RANDOM
    MONSTER=`echo $MONSTER | cut -b 1-2`
    NUM=`echo $NUM | cut -b 1-2`

    let "MONSTER=MONSTER+3"
    
    if [ ! -e drum ]; then
       let "MONSTER=MONSTER-2"
    fi
    
    echo "The monster rolled " $MONSTER
    echo "You rolled " $NUM

    if [[ -e wizard-dark && -e wizard-light ]]; then
	let "NUM=NUM+2"
	echo "+2 Arnnisen the Gray"
    fi

    if [[ -e ../../.bless ]]; then
	let "NUM=NUM+2"
	echo "+2 POSIX wizard bonus!"
    fi
    resolve
}

gameover () {
    cat << EOF > corpse
You see the corpse of a slain adventurer on the floor of the
dungeon.  You find the following items on the corpse:  

${I}

EOF
    curr=`basename $PWD`
    while [ "$curr" != "entrance" ]; do
        pushd .. &> /dev/null
        dirs -c
        curr=`basename $PWD`
    done
    unset I
    unset HP
    $SHELL
}

flee () {
    cat << EOF
You turn to flee but find that you cannot.  You spend 1000
years as a mindless servant to the crawling chaos.  When you
awaken, you may attempt to fight for your liberation.  

EOF
}

resolve() {
    if [[ $MONSTER -eq $NUM ]]; then
        cat << EOF
You dodge an attack, but you miss your mark as a result.
Roll again...

EOF
	roll
    fi
    
    if [[ $MONSTER -lt $NUM ]]; then
<<<<<<< HEAD
        cat << EOF
A hit! A palpable hit!  You have vanquished the elder god of
chaos!

EOF
       cat << EOF > treasure
#!/bin/bash
if ! grep  --quiet --only-matching hair <<< \$I; then
    cat << eof
You have found a lock of the **hair** of a god!  Add it to your inventory.

eof
else 
    echo "This treasure has already been taken."
fi

EOF
       chmod +x treasure
       cat << EOF > platinum
#!/bin/bash
if ! grep  --quiet --only-matching bracelet <<< \$I; then
    cat << eof
You have found an enchanted *bracelet* of chaotic
necromancy!  Add it to your inventory.

eof
else
    echo "This treasure has already been taken."
fi

EOF
        chmod +x platinum
        cat << EOF > end 
You have reached the end of the game.  You know enough Bash
now to use it for every day activities.  Practice makes
perfect, so be sure to use it often.  For continued Bash
tips, visit opensource.com often.

And eventually, we hope to see you contribute your own
dungeon rooms to Bashcrawl!

EOF

=======
       echo "A hit! A palpable hit!"
       echo "You have vanquished the elder god of chaos!"
       echo "echo 'You have found a lock of the **hair** of a god!'" > treasure
       echo "echo 'Add it to your inventory.'" >> treasure
       chmod +x treasure
       echo "echo 'You have found an enchanted *bracelet* of chaotic necromancy!'" > platinum
       echo "echo 'Add it to your inventory.'" >> platinum
       chmod +x platinum
>>>>>>> parent of e70d987 (play test fixes)
    else
        cat << EOF
Your sword swings harmlessly through the air.  You take 10
points damage from your foe. Deduct this from your HP.  

let "HP=HP-10"

EOF
        let HP=HP-10
        export HP
        if [ "$HP" -le 0 ]; then
            cat << EOF
The elder god of chaos consumes your body and soul.  You
have been slain.

GAME OVER!

EOF
            gameover
            exit 1
        fi
	    roll
    fi
}

<<<<<<< HEAD
cat << EOF
In the blink of an eye, Nyarlathotep is standing before you.
From its hands emanate black necrotic rays, and your mind
screams.

EOF
printf "Are you armed? y/n  "
=======
echo "In the blink of an eye, Nyarlathotep is standing before you."
echo "From its hands emanate black necrotic rays, and your mind screams."
printf "\n"
echo "Are you armed?"
>>>>>>> parent of e70d987 (play test fixes)
read RESP

if [ "$RESP" = "y" -o "$RESP" = "Y" ]; then

    if grep  --quiet --only-matching "sword" <<< $I; then
        roll
    else
        cat << EOF
Oh, no!  You have lost your blade!  Nyarlathotep, the elder
god of chaos, senses your weakness.  

EOF
        flee
    fi
else
    flee
fi
<<<<<<< HEAD


















































































































































































































































































# Hmm, that didn't work.
=======
printf "\n"
>>>>>>> parent of e70d987 (play test fixes)
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
##
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#

#
# Well that didn't work!

#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
##
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#
#

#
# Well that didn't work!
